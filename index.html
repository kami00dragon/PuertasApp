<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puertas App - Tarjetas Japonesas</title>
    <style>
        :root {
            --bg-paper: #ffffff;     
            --bg-pattern: #f9f9f9;   
            --torii-red: #BC002D;    
            --ink-black: #2c3e50;   
            --theme-color: var(--torii-red);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Segoe UI', 'Hiragino Sans', 'Noto Sans JP', sans-serif; 
        }
        
        body { 
            background-color: var(--bg-pattern);
            color: var(--ink-black);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            background: white;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-bottom: 4px solid var(--torii-red);
            position: sticky; 
            top: 0; 
            z-index: 100;
        }

        .app-logo {
            width: 60px; 
            height: 40px; 
            fill: var(--torii-red); 
            margin-bottom: 0.3rem;
        }

        .header-title { 
            font-size: 1.4rem; 
            color: var(--ink-black); 
            font-weight: 700; 
            letter-spacing: 2px; 
            text-transform: uppercase; 
        }
        
        .header-subtitle { 
            font-size: 0.9rem; 
            color: #666; 
            margin-top: 0.2rem; 
            font-style: italic; 
        }
        
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 2rem 1rem;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .search-box {
            width: 100%;
            max-width: 500px;
            margin-bottom: 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }

        .search-input:focus {
            border-color: var(--torii-red);
            box-shadow: 0 0 0 3px rgba(188, 0, 45, 0.1);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            width: 100%;
        }

        .torii-card {
            width: 280px;
            height: 280px;
            position: relative;
            cursor: pointer;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            transform-origin: center center;
        }

        .torii-card.expanding {
            position: fixed;
            top: 50%;
            left: 50%;
            z-index: 1000;
            margin: 0;
            border-radius: 0;
            animation: expandTorii 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .torii-card.expanded {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1000;
            margin: 0;
            border-radius: 0;
            animation: none;
        }

        @keyframes expandTorii {
            0% {
                width: 280px;
                height: 280px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                width: 100vw;
                height: 100vh;
                top: 0;
                left: 0;
                transform: translate(-50%, -50%) scale(1);
            }
        }

.card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-weight: bold;
            padding: 15px;
            flex-direction: column;
            border: 1px solid #eee;
            background: white;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .torii-card.expanding .card-face {
            animation: fadeOutFront 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .torii-card.expanded .card-face {
            border-radius: 0;
            box-shadow: none;
        }

        .card-back {
            transform: rotateY(180deg);
            background: white;
            opacity: 0;
        }

        .torii-card.expanding .card-back {
            animation: fadeInBack 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.6s forwards;
        }

        @keyframes fadeOutFront {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes fadeInBack {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .torii-card.expanded .card-face {
            border-radius: 0;
            box-shadow: none;
        }

        .card-back {
            transform: rotateY(180deg);
            background: white;
        }

        /* Estilo Torii para las tarjetas */
        .card-front::before {
            content: ''; 
            position: absolute; 
            top: -8px; left: -8px; right: -8px; height: 16px; 
            background: var(--torii-red); 
            z-index: 2;
            border-radius: 10px 10px 0 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-front::after {
            content: ''; 
            position: absolute; 
            top: 24px; left: -8px; right: -8px; height: 6px; 
            background: var(--torii-red); 
            z-index: 2;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .torii-card.expanding .card-front::before,
        .torii-card.expanded .card-front::before {
            height: 30px;
            top: -20px;
            left: -20px;
            right: -20px;
            background: var(--torii-red) !important;
        }

        .torii-card.expanding .card-front::after,
        .torii-card.expanded .card-front::after {
            height: 15px;
            top: 40px;
            left: -20px;
            right: -20px;
            background: var(--torii-red) !important;
        }

        .torii-card.expanding .card-back::before,
        .torii-card.expanded .card-back::before {
            content: ''; 
            position: absolute; 
            top: -20px; left: -20px; right: -20px; height: 30px; 
            background: var(--torii-red) !important; 
            z-index: 2;
        }

        .torii-card.expanding .card-back::after,
        .torii-card.expanded .card-back::after {
            content: ''; 
            position: absolute; 
            top: 40px; left: -20px; right: -20px; height: 15px; 
            background: var(--torii-red) !important; 
            z-index: 2;
        }

        .torii-pillars {
            position: absolute; 
            left: -8px; 
            top: 0; 
            width: calc(100% + 16px); 
            height: 100%;
            border-left: 8px solid var(--torii-red); 
            border-right: 8px solid var(--torii-red);
            pointer-events: none; 
            z-index: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .torii-card.expanding .torii-pillars,
        .torii-card.expanded .torii-pillars {
            left: -20px;
            width: calc(100% + 40px);
            border-left: 20px solid var(--torii-red);
            border-right: 20px solid var(--torii-red);
        }

        .card-back {
            background: white;
            padding: 30px;
            overflow-y: auto;
            transform: rotateY(180deg);
        }

        .torii-card.expanded .card-front {
            opacity: 0.1;
        }

        .jp-content { 
            font-size: 1rem; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100%; 
            background: #fff;
            color: var(--ink-black);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .kanji-display { 
            font-size: 3.5rem; 
            margin-bottom: 15px; 
            line-height: 1; 
            font-family: serif; 
            color: var(--ink-black);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .torii-card.expanded .kanji-display {
            font-size: 8rem;
            margin-bottom: 30px;
        }

        .kana-display { 
            font-size: 1.3rem; 
            opacity: 0.8; 
            color: #555; 
            font-weight: normal;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .torii-card.expanded .kana-display {
            font-size: 2.5rem;
            opacity: 0.7;
        }

        .back-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: white;
            position: relative;
        }

        .content-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .empty-back {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #ccc;
            font-size: 1.2rem;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .empty-back.hidden {
            display: none;
        }

        .empty-back-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }

        .editable-content {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: 40px;
            overflow-y: auto;
        }

        .editable-content.show {
            display: flex;
        }

        .content-title {
            font-size: 2rem;
            color: var(--ink-black);
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 2px solid var(--torii-red);
            padding-bottom: 15px;
        }

        .content-text {
            flex: 1;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.2rem;
            line-height: 1.8;
            color: var(--ink-black);
            min-height: 200px;
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 20px;
            outline: none;
            transition: border-color 0.3s;
            background: rgba(255, 255, 255, 0.9);
        }

        .content-text:focus {
            border-color: var(--torii-red);
        }

        .content-images {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .content-image {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            object-fit: cover;
        }

.content-video {
            max-width: 600px;
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
        }

        .content-video.show {
            display: block;
        }

        .video-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            margin: 20px 0;
        }

        .video-play-btn {
            background: var(--torii-red) !important;
            color: white !important;
            border: none !important;
            padding: 15px 30px !important;
            border-radius: 8px !important;
            font-size: 1.1rem !important;
            cursor: pointer !important;
            transition: all 0.3s !important;
            z-index: 1001 !important;
            position: relative !important;
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }

        .video-play-btn:hover {
            background: #a00225 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(188, 0, 45, 0.4) !important;
        }

        .content-video.show {
            display: block;
        }

        .video-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .video-play-btn {
            background: var(--torii-red) !important;
            color: white !important;
            border: none !important;
            padding: 15px 30px !important;
            border-radius: 8px !important;
            font-size: 1.1rem !important;
            cursor: pointer !important;
            transition: all 0.3s !important;
            z-index: 1001 !important;
            position: relative !important;
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            margin: 20px auto !important;
        }

        .video-play-btn:hover {
            background: #a00225 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(188, 0, 45, 0.4) !important;
        }

        .add-content-btn {
            position: absolute;
            bottom: 40px;
            right: 40px;
            background: var(--torii-red);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(188, 0, 45, 0.3);
            transition: all 0.3s;
            z-index: 10;
        }

        .add-content-btn:hover {
            background: #a00225;
            transform: scale(1.1);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--torii-red);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1001;
            display: none;
            transition: all 0.3s;
        }

        .close-btn.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #a00225;
            transform: rotate(90deg);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .torii-card.expanded .kanji-display {
                font-size: 5rem;
            }
            
            .torii-card.expanded .kana-display {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <svg class="app-logo" viewBox="0 0 100 60" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="5" width="8" height="50" fill="#BC002D" rx="1"/>
            <rect x="82" y="5" width="8" height="50" fill="#BC002D" rx="1"/>
            <path d="M5,10 Q50,-10 95,10 L95,18 Q50,0 5,18 Z" fill="#BC002D"/>
            <rect x="10" y="22" width="80" height="6" fill="#BC002D"/>
        </svg>
        <div class="header-title">Puertas App</div>
        <div class="header-subtitle">Tarjetas de Kanji Japonesas</div>
    </header>

    <main>
        <div class="search-box">
            <input type="text" class="search-input" placeholder="Buscar por kanji, kana o romaji...">
        </div>
        
        <div id="cards-container" class="cards-grid">
            <div class="loading">Cargando tarjetas...</div>
        </div>
    </main>

    <div class="overlay" id="overlay"></div>
    <button class="close-btn" id="close-btn">√ó</button>

    <script>
        let allCards = [];
        let filteredCards = [];
        let currentExpandedCard = null;
        let cardData = {};

        // Cargar datos de tarjetas y contenido guardado
        async function loadCards() {
            try {
                // Cargar datos JSON
                const response = await fetch('vocabulario-jlpt-4000.json');
                const data = await response.json();
                allCards = data.words;
                
                // Cargar contenido guardado de localStorage
                const savedData = localStorage.getItem('puertasApp_data');
                if (savedData) {
                    cardData = JSON.parse(savedData);
                } else {
                    // Inicializar estructura de datos para cada tarjeta
                    allCards.forEach(card => {
                        cardData[card.kanji] = {
                            text: '',
                            imageUrl: '',
                            kana: card.kana
                        };
                    });
                    saveCardData();
                }
                
                console.log(`Cargadas ${allCards.length} tarjetas`);
                filterAndDisplayCards();
            } catch (error) {
                console.error('Error al cargar tarjetas:', error);
                document.getElementById('cards-container').innerHTML = 
                    '<div class="loading">Error al cargar las tarjetas. Por favor, recarga la p√°gina.</div>';
            }
        }

        function saveCardData() {
            localStorage.setItem('puertasApp_data', JSON.stringify(cardData));
        }

        function filterAndDisplayCards() {
            const searchTerm = document.querySelector('.search-input').value.toLowerCase().trim();
            
            if (searchTerm) {
                filteredCards = allCards.filter(card => 
                    card.kanji.toLowerCase().includes(searchTerm) ||
                    card.kana.toLowerCase().includes(searchTerm) ||
                    card.romaji.toLowerCase().includes(searchTerm)
                );
            } else {
                filteredCards = allCards;
            }
            
            displayCards();
        }

        function displayCards() {
            const container = document.getElementById('cards-container');
            
            if (filteredCards.length === 0) {
                container.innerHTML = '<div class="loading">No se encontraron tarjetas.</div>';
                return;
            }
            
            container.innerHTML = '';
            
            filteredCards.forEach(card => {
                const cardElement = createCard(card);
                container.appendChild(cardElement);
            });
        }

        function createCard(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'torii-card';
            cardDiv.dataset.kanji = card.kanji;
            
            const savedContent = cardData[card.kanji] || { text: '', imageUrl: '', kana: card.kana };
            
            // A√±adir video al primer kanji
            const isFirstCard = filteredCards.indexOf(card) === 0;
            const videoContent = isFirstCard ? `
                <div class="video-container">
                    <button class="video-play-btn" onclick="playVideo('${card.kanji}')">‚ñ∂ Reproducir Video</button>
                    <video class="content-video" id="video-${card.kanji}" controls>
                        <source src="videos/story_clip_1.mp4" type="video/mp4">
                        Tu navegador no soporta video.
                    </video>
                </div>
            ` : '';
            const isFirstCardContent = isFirstCard ? 'show' : '';
            const emptyHidden = isFirstCard ? 'hidden' : '';
            
            cardDiv.innerHTML = `
                <div class="torii-pillars"></div>
                <div class="card-face card-front">
                    <div class="jp-content">
                        <div class="kanji-display">${card.kanji}</div>
                        <div class="kana-display">${savedContent.kana || card.kana}</div>
                    </div>
                </div>
                <div class="card-face card-back">
                    <div class="back-content">
                        <div class="content-area">
                            <div class="empty-back ${emptyHidden}" id="empty-${card.kanji}">
                                <div class="empty-back-icon">üìù</div>
                                <div>Espacio para contenido</div>
                            </div>
                            <div class="editable-content ${isFirstCardContent}" id="content-${card.kanji}">
                                <h2 class="content-title">${card.kanji}</h2>
                                <div class="content-text" contenteditable="true" data-kanji="${card.kanji}" id="text-${card.kanji}">${savedContent.text || ''}</div>
                                <div class="content-images" id="images-${card.kanji}">
                                    ${videoContent}
                                    ${savedContent.images ? savedContent.images.map(img => `<img src="${img}" class="content-image" alt="Imagen">`).join('') : ''}
                                </div>
                            </div>
                            <button class="add-content-btn" onclick="toggleEditMode('${card.kanji}')">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            // Event listeners
            cardDiv.addEventListener('click', function(e) {
                if (e.target.classList.contains('add-content-btn') || 
                    e.target.classList.contains('content-text')) {
                    return; // No expandir si se est√° editando
                }
                expandCard(this);
            });
            
            // Auto-save text editor
            const textEditor = cardDiv.querySelector('.content-text');
            textEditor.addEventListener('input', function() {
                const kanji = this.dataset.kanji;
                if (!cardData[kanji]) {
                    cardData[kanji] = { text: '', images: [], kana: card.kana };
                }
                cardData[kanji].text = this.innerHTML;
                saveCardData();
            });
            
            return cardDiv;
        }

        function expandCard(card) {
            if (currentExpandedCard === card) return;
            
            // Cerrar tarjeta actual si hay una abierta
            if (currentExpandedCard) {
                closeCard();
            }
            
            currentExpandedCard = card;
            card.classList.add('expanding');
            
            // Despu√©s de la animaci√≥n de expansi√≥n, cambiar a expanded
            setTimeout(() => {
                card.classList.remove('expanding');
                card.classList.add('expanded');
            }, 1200);
            
            document.getElementById('overlay').classList.add('show');
            document.getElementById('close-btn').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeCard() {
            if (currentExpandedCard) {
                currentExpandedCard.classList.remove('expanded');
                currentExpandedCard = null;
            }
            document.getElementById('overlay').classList.remove('show');
            document.getElementById('close-btn').classList.remove('show');
            document.body.style.overflow = '';
        }

function toggleEditMode(kanji) {
            const emptyBack = document.getElementById(`empty-${kanji}`);
            const editableContent = document.getElementById(`content-${kanji}`);
            
            emptyBack.classList.add('hidden');
            editableContent.classList.add('show');
            
            // Inicializar si no hay datos
            if (!cardData[kanji]) {
                cardData[kanji] = { text: '', images: [], kana: kanji };
                saveCardData();
            }
        }

        function playVideo(kanji) {
            console.log('Playing video for kanji:', kanji);
            const video = document.getElementById(`video-${kanji}`);
            const btn = event.target;
            
            if (video) {
                video.classList.add('show');
                btn.style.display = 'none';
                
                // Intentar reproducir el video
                video.play().then(() => {
                    console.log('Video playing successfully');
                }).catch(error => {
                    console.log('Video play error:', error);
                });
            }
        }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadCards();
            
            // Search functionality
            document.querySelector('.search-input').addEventListener('input', filterAndDisplayCards);
            
            // Close button
            document.getElementById('close-btn').addEventListener('click', closeCard);
            
            // Overlay click to close
            document.getElementById('overlay').addEventListener('click', closeCard);
            
            // ESC key to close
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeCard();
            });
        });
    </script>
</body>
</html>